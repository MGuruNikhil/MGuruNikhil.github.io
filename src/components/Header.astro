---
import IconSprite from './IconSprite.astro'
---

<header class="border-b card-border">
  <IconSprite />
  <div class="container mx-auto px-4 py-4 flex items-center justify-between">
    <a href="/" class="flex items-center gap-3">
      <img src="https://github.com/MGuruNikhil.png" alt="avatar" class="w-10 h-10 rounded-full" />
      <span class="font-semibold">Guru Nikhil Mangaraju</span>
    </a>

    <nav class="hidden md:flex items-center gap-6 text-sm">
      <a href="/about" class="link-underline">About</a>
      <a href="/projects" class="link-underline">Projects</a>
      <a href="/work" class="link-underline">Work</a>
      <a href="/resume" class="link-underline">Resume</a>
      <a href="/contact" class="link-underline">Contact</a>
    </nav>

    <div class="flex items-center gap-3">
      <button id="theme-toggle" class="icon-link" aria-label="Toggle theme" aria-pressed="false" type="button">
        <svg id="theme-icon" class="icon"><use href="#icon-sun" /></svg>
      </button>

      <a class="icon-link" href="https://github.com/MGuruNikhil" target="_blank" rel="noreferrer" aria-label="GitHub">
        <svg class="icon"><use href="#icon-github" /></svg>
      </a>
      <a class="icon-link" href="https://www.linkedin.com/in/gurunikhilm/" target="_blank" rel="noreferrer" aria-label="LinkedIn">
        <svg class="icon"><use href="#icon-linkedin" /></svg>
      </a>
    </div>
  </div>

  
</header>

<script is:inline>
  (function () {
    try {
      var btn = document.getElementById('theme-toggle')
      var icon = document.getElementById('theme-icon')
      if (!btn || !icon) return

      function updateIcon(theme) {
        var use = icon.querySelector('use')
        if (!use) return
        use.setAttribute('href', theme === 'dark' ? '#icon-moon' : '#icon-sun')
        btn.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false')
      }

      // Initialize based on pre-run theme (ThemeScript sets this synchronously)
      var current = window.getTheme ? window.getTheme() : (document.documentElement.classList.contains('dark') ? 'dark' : 'light')
      updateIcon(current)

      // Listen for click -> call toggleTheme exposed by ThemeScript
      btn.addEventListener('click', function () {
        if (window.toggleTheme) {
          var isDark = window.toggleTheme()
          updateIcon(isDark ? 'dark' : 'light')
        }
      })

      // Also listen for programmatic theme changes
      window.addEventListener('themechange', function (e) { updateIcon(e.detail && e.detail.theme) })
    } catch (e) { console.warn('Theme toggle init failed', e) }
  })()
</script>
